<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ganesh Pooja Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .title-gradient {
            background: linear-gradient(45deg, #f59e0b, #facc15, #ef4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }
        .collection-gradient { background: linear-gradient(45deg, #10b981, #34d399); }
        .expense-gradient { background: linear-gradient(45deg, #ef4444, #f87171); }
        .balance-gradient { background: linear-gradient(45deg, #3b82f6, #60a5fa); }
        .btn:hover { transform: translateY(-2px); }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
    </style>
</head>
<body class="bg-slate-50">

    <div class="container mx-auto p-4 sm:p-8 max-w-4xl">
        <div class="bg-white p-8 rounded-3xl shadow-lg space-y-10">
            <header class="text-center">
                <h1 class="text-4xl md:text-5xl font-extrabold title-gradient">Ganesh Pooja Tracker üôè</h1>
            </header>

            <section class="grid grid-cols-1 sm:grid-cols-3 gap-6 text-center">
                <div class="card p-6 text-white collection-gradient rounded-2xl">
                    <h2 class="text-xl font-bold">Total Collection</h2>
                    <p id="totalCollection" class="text-4xl font-extrabold mt-2">‚Çπ0</p>
                </div>
                <div class="card p-6 text-white expense-gradient rounded-2xl">
                    <h2 class="text-xl font-bold">Total Expenses</h2>
                    <p id="totalExpenses" class="text-4xl font-extrabold mt-2">‚Çπ0</p>
                </div>
                <div class="card p-6 text-white balance-gradient rounded-2xl">
                    <h2 class="text-xl font-bold">Balance</h2>
                    <p id="balance" class="text-4xl font-extrabold mt-2">‚Çπ0</p>
                </div>
            </section>
            
            <section class="space-y-4">
                <h3 class="text-3xl font-bold text-gray-800 text-center">Expense Breakdown</h3>
                <div class="chart-container relative h-80 w-full max-w-lg mx-auto">
                    <canvas id="expenseChart"></canvas>
                </div>
            </section>

            <main class="grid grid-cols-1 gap-12">
                <div id="collections-section" class="space-y-6">
                    <h3 class="text-3xl font-bold text-gray-800">Collections üí∞</h3>
                    <form id="collectionForm" class="flex flex-col sm:flex-row gap-4 p-4 bg-slate-100 rounded-2xl">
                        <input type="text" id="collectionName" placeholder="Name" required class="flex-grow p-3 rounded-lg border">
                        <input type="number" id="collectionAmount" placeholder="Amount (‚Çπ)" required class="flex-grow p-3 rounded-lg border">
                        <button type="submit" class="btn px-6 py-3 font-semibold text-white bg-green-500 hover:bg-green-600 rounded-lg transition-transform">Add Collection</button>
                    </form>
                    <div class="overflow-x-auto">
                        <table class="w-full" id="collectionsTable">
                            <thead class="border-b">
                                <tr class="text-gray-500 text-sm uppercase">
                                    <th class="py-3 text-left">Name</th>
                                    <th class="py-3 text-left">Amount</th>
                                    <th class="py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="expenses-section" class="space-y-6">
                    <h3 class="text-3xl font-bold text-gray-800">Expenses üí∏</h3>
                    <form id="expenseForm" class="flex flex-col sm:flex-row gap-4 p-4 bg-slate-100 rounded-2xl">
                        <input type="text" id="expenseItem" placeholder="Item" required class="flex-grow p-3 rounded-lg border">
                        <input type="number" id="expenseAmount" placeholder="Amount (‚Çπ)" required class="flex-grow p-3 rounded-lg border">
                        <button type="submit" class="btn px-6 py-3 font-semibold text-white bg-red-500 hover:bg-red-600 rounded-lg transition-transform">Add Expense</button>
                    </form>
                    <div class="overflow-x-auto">
                        <table class="w-full" id="expensesTable">
                            <thead class="border-b">
                                <tr class="text-gray-500 text-sm uppercase">
                                    <th class="py-3 text-left">Item</th>
                                    <th class="py-3 text-left">Amount</th>
                                    <th class="py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="sponsors-section" class="space-y-6">
                    <h3 class="text-3xl font-bold text-gray-800">Sponsors ‚ú®</h3>
                    <form id="sponsorForm" class="flex flex-col sm:flex-row gap-4 p-4 bg-slate-100 rounded-2xl">
                        <input type="text" id="sponsorName" placeholder="Sponsor Name" required class="flex-grow p-3 rounded-lg border">
                        <input type="text" id="sponsorDetails" placeholder="Contribution Details" required class="flex-grow p-3 rounded-lg border">
                        <button type="submit" class="btn px-6 py-3 font-semibold text-white bg-blue-500 hover:bg-blue-600 rounded-lg transition-transform">Add Sponsor</button>
                    </form>
                    <div class="overflow-x-auto">
                        <table class="w-full" id="sponsorsTable">
                            <thead class="border-b">
                                <tr class="text-gray-500 text-sm uppercase">
                                    <th class="py-3 text-left">Name</th>
                                    <th class="py-3 text-left">Contribution</th>
                                    <th class="py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="editModal" class="modal-overlay">
        <div class="modal-content bg-white p-8 rounded-2xl shadow-xl w-full max-w-md space-y-4">
            <h3 class="text-2xl font-bold text-center">Edit Entry</h3>
            <form id="editForm" class="space-y-4">
                <input type="hidden" id="editType">
                <input type="hidden" id="editId">
                <input type="text" id="editName" placeholder="Name/Item" required class="w-full p-3 rounded-lg border">
                <input type="text" id="editDetail" placeholder="Amount/Details" required class="w-full p-3 rounded-lg border">
                <div class="flex justify-end gap-4 pt-4">
                    <button type="button" id="cancelEdit" class="btn px-6 py-2 font-semibold text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-lg transition-transform">Cancel</button>
                    <button type="submit" class="btn px-6 py-2 font-semibold text-white bg-blue-500 hover:bg-blue-600 rounded-lg transition-transform">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let collections = [];
            let expenses = [];
            let sponsors = [];
            let expenseChart;

            const DOM = {
                collectionForm: document.getElementById('collectionForm'),
                expenseForm: document.getElementById('expenseForm'),
                sponsorForm: document.getElementById('sponsorForm'),
                collectionsTable: document.querySelector('#collectionsTable tbody'),
                expensesTable: document.querySelector('#expensesTable tbody'),
                sponsorsTable: document.querySelector('#sponsorsTable tbody'),
                totalCollection: document.getElementById('totalCollection'),
                totalExpenses: document.getElementById('totalExpenses'),
                balance: document.getElementById('balance'),
                editModal: document.getElementById('editModal'),
                editForm: document.getElementById('editForm'),
                cancelEdit: document.getElementById('cancelEdit'),
                editType: document.getElementById('editType'),
                editId: document.getElementById('editId'),
                editName: document.getElementById('editName'),
                editDetail: document.getElementById('editDetail'),
                chartCanvas: document.getElementById('expenseChart').getContext('2d'),
            };

            const generateId = () => `id_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

            const renderRow = (tableBody, item, type) => {
                const row = document.createElement('tr');
                row.className = 'border-b';
                let content = '';
                if (type === 'collection') {
                    content = `<td class="py-3">${item.name}</td><td class="py-3">‚Çπ${item.amount.toLocaleString()}</td>`;
                } else if (type === 'expense') {
                    content = `<td class="py-3">${item.item}</td><td class="py-3">‚Çπ${item.amount.toLocaleString()}</td>`;
                } else if (type === 'sponsor') {
                    content = `<td class="py-3">${item.name}</td><td class="py-3">${item.detail}</td>`;
                }
                row.innerHTML = `
                    ${content}
                    <td class="py-3 text-right">
                        <button class="edit-btn p-2 text-blue-500 hover:text-blue-700" data-id="${item.id}" data-type="${type}">‚úèÔ∏è</button>
                        <button class="delete-btn p-2 text-red-500 hover:text-red-700" data-id="${item.id}" data-type="${type}">‚ùå</button>
                    </td>`;
                tableBody.appendChild(row);
            };
            
            const renderAll = () => {
                DOM.collectionsTable.innerHTML = '';
                collections.forEach(item => renderRow(DOM.collectionsTable, item, 'collection'));

                DOM.expensesTable.innerHTML = '';
                expenses.forEach(item => renderRow(DOM.expensesTable, item, 'expense'));

                DOM.sponsorsTable.innerHTML = '';
                sponsors.forEach(item => renderRow(DOM.sponsorsTable, item, 'sponsor'));

                updateSummary();
                renderExpenseChart();
            };

            const updateSummary = () => {
                const totalCollections = collections.reduce((sum, item) => sum + item.amount, 0);
                const totalExpenses = expenses.reduce((sum, item) => sum + item.amount, 0);
                const balance = totalCollections - totalExpenses;

                DOM.totalCollection.textContent = `‚Çπ${totalCollections.toLocaleString()}`;
                DOM.totalExpenses.textContent = `‚Çπ${totalExpenses.toLocaleString()}`;
                DOM.balance.textContent = `‚Çπ${balance.toLocaleString()}`;
            };

            const renderExpenseChart = () => {
                if (expenseChart) {
                    expenseChart.destroy();
                }
                
                const expenseLabels = expenses.map(e => e.item);
                const expenseData = expenses.map(e => e.amount);

                if (expenses.length === 0) {
                    DOM.chartCanvas.canvas.parentElement.style.display = 'none';
                    return;
                }
                DOM.chartCanvas.canvas.parentElement.style.display = 'block';

                expenseChart = new Chart(DOM.chartCanvas, {
                    type: 'doughnut',
                    data: {
                        labels: expenseLabels,
                        datasets: [{
                            data: expenseData,
                            backgroundColor: [
                                '#ef4444', '#f97316', '#eab308', '#84cc16', '#22c55e',
                                '#14b8a6', '#06b6d4', '#3b82f6', '#8b5cf6', '#d946ef'
                            ],
                            borderColor: '#ffffff',
                            borderWidth: 2,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(context.parsed);
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            };

            const showEditModal = (type, id) => {
                const dataMap = { collection: collections, expense: expenses, sponsor: sponsors };
                const item = dataMap[type].find(i => i.id === id);
                if (!item) return;

                DOM.editType.value = type;
                DOM.editId.value = id;
                DOM.editName.value = item.name || item.item;
                
                if (type === 'sponsor') {
                    DOM.editDetail.value = item.detail;
                    DOM.editDetail.type = 'text';
                    DOM.editDetail.placeholder = "Contribution Details";
                } else {
                    DOM.editDetail.value = item.amount;
                    DOM.editDetail.type = 'number';
                    DOM.editDetail.placeholder = "Amount (‚Çπ)";
                }
                DOM.editModal.style.display = 'flex';
            };

            const hideEditModal = () => {
                DOM.editModal.style.display = 'none';
            };

            DOM.collectionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = DOM.collectionForm.querySelector('#collectionName').value;
                const amount = parseFloat(DOM.collectionForm.querySelector('#collectionAmount').value);
                if (name && amount > 0) {
                    collections.push({ id: generateId(), name, amount });
                    DOM.collectionForm.reset();
                    renderAll();
                }
            });

            DOM.expenseForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const item = DOM.expenseForm.querySelector('#expenseItem').value;
                const amount = parseFloat(DOM.expenseForm.querySelector('#expenseAmount').value);
                if (item && amount > 0) {
                    expenses.push({ id: generateId(), item, amount });
                    DOM.expenseForm.reset();
                    renderAll();
                }
            });

            DOM.sponsorForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = DOM.sponsorForm.querySelector('#sponsorName').value;
                const detail = DOM.sponsorForm.querySelector('#sponsorDetails').value;
                if (name && detail) {
                    sponsors.push({ id: generateId(), name, detail });
                    DOM.sponsorForm.reset();
                    renderAll();
                }
            });
            
            document.addEventListener('click', (e) => {
                if (e.target.closest('.edit-btn')) {
                    const btn = e.target.closest('.edit-btn');
                    showEditModal(btn.dataset.type, btn.dataset.id);
                }
                if (e.target.closest('.delete-btn')) {
                    const btn = e.target.closest('.delete-btn');
                    const { type, id } = btn.dataset;
                    if (type === 'collection') collections = collections.filter(i => i.id !== id);
                    if (type === 'expense') expenses = expenses.filter(i => i.id !== id);
                    if (type === 'sponsor') sponsors = sponsors.filter(i => i.id !== id);
                    renderAll();
                }
            });

            DOM.editForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const { editType, editId, editName, editDetail } = DOM;
                const type = editType.value;
                const id = editId.value;
                const name = editName.value;

                if (type === 'collection' || type === 'expense') {
                    const amount = parseFloat(editDetail.value);
                    if (!name || amount <= 0) return;
                    const list = type === 'collection' ? collections : expenses;
                    const item = list.find(i => i.id === id);
                    if (item) {
                        if (type === 'collection') item.name = name;
                        else item.item = name;
                        item.amount = amount;
                    }
                } else if (type === 'sponsor') {
                    const detail = editDetail.value;
                    if (!name || !detail) return;
                    const item = sponsors.find(i => i.id === id);
                    if (item) {
                        item.name = name;
                        item.detail = detail;
                    }
                }
                hideEditModal();
                renderAll();
            });

            DOM.cancelEdit.addEventListener('click', hideEditModal);
            DOM.editModal.addEventListener('click', (e) => {
                if (e.target === DOM.editModal) hideEditModal();
            });

            renderAll();
        });
    </script>
</body>
</html>
